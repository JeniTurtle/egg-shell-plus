<html><head>
  <meta charset="UTF-8">
  <title>Swagger Ui - egg-shell-plus</title>
  <meta name="description" content="ç»™ä½ çš„è›‹è›‹åŠ ä¸ªå£³">
  <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <link rel="stylesheet" href="css/vue.css">
  <style>
    .markdown-section a:not(:hover) {
      text-decoration: none;
    }
    .sidebar {
      padding-top: 20px;
    }
    .sidebar h1 {
      font-weight: normal;
    }
    .sidebar blockquote {
      margin-left: 12px;
    }
    section.content {
      padding-top: 50px;
    }
  </style>
<style type="text/css">.medium-zoom-overlay{position:fixed;top:0;right:0;bottom:0;left:0;opacity:0;transition:opacity .3s;will-change:opacity}.medium-zoom--open .medium-zoom-overlay{cursor:pointer;cursor:zoom-out;opacity:1}.medium-zoom-image{cursor:pointer;cursor:zoom-in;transition:transform .3s}.medium-zoom-image--open{position:relative;cursor:pointer;cursor:zoom-out;will-change:transform}</style></head>
<body data-page="README.md" class="ready sticky">
  <nav class="app-nav"></nav><main><button class="sidebar-toggle"><div class="sidebar-toggle-button"><span></span><span></span><span></span></div></button><aside class="sidebar"><h1 class="app-name" style="text-align: left; padding-left: 20px;"><a class="app-name-link" data-nosearch="" href="/egg-shell-decorators/">egg-shell-plus</a></h1><div class="sidebar-nav"><ul><li class=""><a class="section-link" href="#/?id=home">Home</a></li><li class=""><a class="section-link" href="#/?id=quickstart">QuickStart</a></li><li class=""><a class="section-link" href="#/?id=usage">Usage</a></li><li><a class="section-link" href="#/?id=option">Option</a></li><li class="active"><a class="section-link" href="#/?id=member">Member</a></li><ul><li><a class="section-link" href="#/?id=http%e7%9b%b8%e5%85%b3">Httpç›¸å…³</a></li><li><a class="section-link" href="#/?id=%e4%b8%ad%e9%97%b4%e4%bb%b6%e7%9b%b8%e5%85%b3">ä¸­é—´ä»¶ç›¸å…³</a></li><li class=""><a class="section-link" href="#/?id=swagger-ui%e7%9b%b8%e5%85%b3">Swagger Uiç›¸å…³</a></li><li><a class="section-link" href="#/?id=jwt%e7%9b%b8%e5%85%b3">Jwtç›¸å…³</a></li><li><a class="section-link" href="#/?id=%e5%85%b6%e4%bb%96">å…¶ä»–</a></li></ul></ul></div></aside><section class="content"><article class="markdown-section" id="main"><h1 id="home"><a href="#/?id=home" data-id="home" class="anchor"><span>Home</span></a></h1>
<blockquote>
<p>Egg.js è·¯ç”±è£…é¥°å™¨ï¼Œè®©ä½ çš„å¼€å‘æ›´æ•æ·~</p></blockquote>
<p><code>è·¯ç”±è§£æ</code>æ˜¯ <a target="_blank">egg-shell-plus</a> æœ€å¤§çš„ç‰¹ç‚¹ï¼Œä½¿ç”¨ Decorator è£…é¥°çš„è·¯ç”±ï¼Œåˆ™ä¼šè¢«è‡ªåŠ¨è§£ææˆå¯¹åº”çš„è·¯ç”±ï¼š</p><ul><li>æ–‡ä»¶è·¯å¾„ï¼š<code>app/controller/home.ts</code><ul><li><code>@Get('/detail/:id')</code></li><li><code>@Post()</code></li></ul></li><li>è§£æè·¯ç”±ï¼š<ul><li><code>[get]  å…¨å±€å‰ç¼€ + /home + /detail/:id</code></li><li><code>[post] å…¨å±€å‰ç¼€ + /home + /</code></li></ul></li></ul><p>è¿™é‡Œçš„ å…¨å±€å‰ç¼€ æŒ‡çš„æ˜¯ä½ åœ¨ EggShell é‡Œé…ç½®çš„ <code>prefix</code>ï¼Œè·¯ç”±è§£æ<code>æ”¯æŒå¤šå±‚çº§è§£æå™¢</code>~</p><blockquote>
<p>ç¤ºèŒƒä»£ç å‡é‡‡ç”¨ TypeScriptã€‚ï¼ˆå·¦è¾¹çš„èœå•å¯ä»¥æ»šåŠ¨çš„å™¢ğŸ‘ˆï¼‰</p></blockquote>
<h1 id="quickstart"><a href="#/?id=quickstart" data-id="quickstart" class="anchor"><span>QuickStart</span></a></h1><p>å’±ä»¬å…ˆå¿«é€Ÿæ¥ä¸€ä¸ªä¾‹å­ï¼š</p><pre v-pre="" data-lang="typescript"><code class="lang-typescript">
import { Controller } from 'egg'

const {
  Get,
  TagsAll,
  IgnoreJwt,
  Prefix,
  Hidden,
  ResponseCode,
  ResponseMessage,
  ResponseErrorCode,
  ResponseErrorMessage
} = require('@/dependency/egg-shell')

@TagsAll('å¸¸ç”¨è£…é¥°å™¨ç¤ºä¾‹')
// Prefixå¯ä»¥ç”¨æŒ‡å®špathæ¥æ›¿æ¢è·¯å¾„å’Œæ–‡ä»¶åä½œä¸ºrouterå‰ç¼€, è¿™é‡Œå°±å˜æˆäº†/demo2/test, è€Œä¸æ˜¯/demo/test
// ä½†ä¸å»ºè®®è¿™ä¹ˆåš, ä¸ºäº†ç¡®ä¿routerä¸ä¼šå› é‡åè¢«è¦†ç›–, å°½é‡ä½¿ç”¨è·¯å¾„å’Œæ–‡ä»¶åä½œä¸ºrouterå‰ç¼€
@Prefix('/Demo2/Test')
export default class TestController extends Controller {
  @IgnoreJwt // å¿½ç•¥JWT
  @Get('/api') // ç”¨æŒ‡å®špathæ¥æ›¿æ¢æ–¹æ³•åä½œä¸ºè·¯ç”±, è¿™é‡Œå°±å˜æˆäº†/demo2/test/api
  @ResponseCode(100) // ä¸è®¾ç½®é»˜è®¤ä¸º600
  @ResponseMessage('request success!') // ä¸è®¾ç½®é»˜è®¤ä¸ºè¯·æ±‚æˆåŠŸ
  public async index(ctx, next) {
    // æ³¨æ„, å¦‚æœåœ¨æ§åˆ¶å™¨é‡Œåšäº†returnä¹‹å, ä¼šè‡ªåŠ¨è°ƒç”¨ä¸€æ¬¡nextæ–¹æ³•, ç»§ç»­æ‰§è¡Œåé¢çš„ä¸­é—´ä»¶ã€‚
    // å½“ç„¶ä¹Ÿå¯ä»¥ä¸åšreturn, è‡ªå·±è°ƒç”¨nextæ–¹æ³•, æˆ–è€…ä¸è°ƒç”¨, ç›´æ¥è¿”å›å“åº”ç»“æœ
    await ctx.service.test.sayHi('test api')
    await next()
  }

  @IgnoreJwt // å¿½ç•¥JWT
  @Get()
  public async html(ctx) {
    // æ³¨æ„, å¦‚æœåœ¨æ§åˆ¶å™¨é‡Œåšäº†returnä¹‹å, ä¼šè‡ªåŠ¨è°ƒç”¨ä¸€æ¬¡nextæ–¹æ³•, ç»§ç»­æ‰§è¡Œåé¢çš„ä¸­é—´ä»¶ã€‚
    // å½“ç„¶ä¹Ÿå¯ä»¥ä¸åšreturn, è‡ªå·±è°ƒç”¨nextæ–¹æ³•, æˆ–è€…ä¸è°ƒç”¨, ç›´æ¥è¿”å›å“åº”ç»“æœ
    ctx.response.type = 'html'
    ctx.response.body = `
        &lt;html&gt;
            &lt;body&gt;
                &lt;h5&gt;hello world&lt;/h5&gt;
            &lt;/body&gt;
        &lt;/html&gt;
    `
  }

  @IgnoreJwt // å¿½ç•¥JWT
  @Get()
  @ResponseErrorCode(200) // ä¸è®¾ç½®é»˜è®¤ä¸º601
  @ResponseErrorMessage('request fail!') // ä¸è®¾ç½®é»˜è®¤ä¸ºè¯·æ±‚å¤±è´¥
  public async error() {
    // 1ã€æ•è·åˆ°é”™è¯¯å¼‚å¸¸å, å¯ä»¥ç›´æ¥æŠ›å‡º, å…¨å±€é”™è¯¯æ–¹æ³•ä¼šæ•è·å¹¶è¾“å‡º
    // 2ã€ä¹Ÿå¯ä»¥returné”™è¯¯å¯¹è±¡, ç»§ç»­æ‰§è¡Œåé¢çš„ä¸­é—´ä»¶
    // 3ã€è¿˜å¯ä»¥è°ƒç”¨ctx.error({ msg: 'fuck!', error: new Error('fuck').data, code: 999 }),
    // è°ƒç”¨ctx.errorå°±ä¸éœ€è¦è®¾ç½®@ResponseErrorCodeå’Œ@ResponseErrorMessageäº†
    throw new Error('Fuck the error!')
  }

  @IgnoreJwt // å¿½ç•¥JWT
  @Hidden // å¯ä»¥ç”¨Hiddenè£…é¥°å™¨åœ¨swaggeræ–‡æ¡£éšè—è¯¥æ¥å£
  @Get()
  public async hidden(ctx) {
    await ctx.service.test.sayHi('hidden api')
  }
}


      </code></pre><p>ä»¥ä¸‹æ˜¯ swagger-ui çš„è·¯ç”±æ˜ å°„ï¼ˆå…·ä½“è¯·çœ‹<code>Example &gt; Swagger UI</code>ï¼‰ï¼š</p><pre v-pre="" data-lang="typescript"><code class="lang-typescript">
import { Controller } from 'egg'
const { Joi } = require('@/dependency/egg-shell')

const {
  Get,
  Post,
  Put,
  Delete,
  TagsAll,
  IgnoreJwtAll,
  Parameters,
  Summary,
  Description,
  Responses
} = require('@/dependency/egg-shell')

const joiScheme = Joi.object()

const PathId = {
  pathParams: Joi.object()
    .keys({
      id: Joi.number()
        .integer()
        .required()
        .description('æ–‡ç« ID')
    })
    .description('pathå‚æ•°')
}

const PostCreate = Joi.object()
  .json()
  .keys({
    title: Joi.string()
      .required()
      .description('æ ‡é¢˜'),
    author: Joi.string()
      .required()
      .description('ä½œè€…'),
    summary: Joi.string()
      .required()
      .description('æ‘˜è¦'),
    pub_date: Joi.date(),
    content: Joi.string()
      .required()
      .description('å†…å®¹(html)')
  })
  .description('æ–‡ç« å†…å®¹æ ¼å¼')

const GetArticleValidate = {
  query: joiScheme.keys({
    page: Joi.number()
      .integer()
      .optional()
      .default(1)
      .description('å½“å‰é¡µæ•°'),
    limit: Joi.number()
      .integer()
      .optional()
      .default(10)
      .description('æ¯é¡µæ¡æ•°')
  })
}

const PostArticleValidate = {
  body: Joi.object().keys({
    entity: PostCreate.required()
  })
}

const PutArticleValidate = {
  pathParams: PathId.pathParams,
  ...PostArticleValidate
}

/**
 * å¯ä»¥åœ¨æ•ˆéªŒè¯·æ±‚å‚æ•°çš„åŒæ—¶,
 * è‡ªåŠ¨ç”Ÿæˆswaggerå‚æ•°æ–‡æ¡£ã€‚
 */
@TagsAll('å‚æ•°æ•ˆéªŒç¤ºä¾‹')
@IgnoreJwtAll
export default class ValidateController extends Controller {
  /**
   * æ³¨æ„! æ³¨æ„!
   * ä¸€ã€@Parametersæ³¨è§£å·²ç»è¢«é‡å†™äº†, å¯ä»¥åœ¨æ•ˆéªŒå‚æ•°çš„åŒæ—¶, å¹¶ç”Ÿæˆswaggerå‚æ•°æ–‡æ¡£ã€‚
   * äºŒã€@Responsesæ³¨è§£ä¹Ÿè¢«é‡å†™äº†, å›ºå®šæ ¼å¼ä¸º:
   * @Responses({ statsu: 200, definition: 'User', description: 'fuck you'})
   * ä¼ å¤šä¸ªè¿”å›çŠ¶æ€, éœ€è¦ä¼ å…¥ä¸€ä¸ªæ•°ç»„ã€‚
   */
  @Get('/articles')
  @Summary('è·å–æ–‡ç« åˆ—è¡¨')
  @Description('ä»queryä¸­æ•ˆéªŒå‚æ•°')
  @Parameters(GetArticleValidate)
  @Responses({ status: 200, definition: 'ValidateTest' })
  public async getArticleList(ctx) {
    return await ctx.service.test.sayHi('get artice list')
  }

  @Get('/article/:id')
  @Summary('è·å–æ–‡ç« åˆ—è¡¨')
  @Description('ä»pathParamä¸­æ•ˆéªŒå‚æ•°')
  @Parameters(PathId)
  @Responses({ status: 200, definition: 'ValidateTest' })
  public async getArticle(ctx) {
    return await ctx.service.test.sayHi('get artice')
  }

  @Post('/article/:id')
  @Summary('åˆ›å»ºæ–‡ç« å†…å®¹')
  @Description('ä»bodyä¸­æ•ˆéªŒå‚æ•°')
  @Parameters(PostArticleValidate)
  @Responses({ status: 200, definition: 'ValidateTest' })
  public async createArticle(ctx) {
    return await ctx.service.test.sayHi('post article')
  }

  @Put('/article/:id')
  @Summary('ä¿®æ”¹æ–‡ç« å†…å®¹')
  @Description('ä»bodyå’ŒpathParamä¸­æ•ˆéªŒå‚æ•°')
  @Parameters(PutArticleValidate)
  @Responses({ status: 200, definition: 'ValidateTest' })
  public async updateArticle(ctx) {
    return await ctx.service.test.sayHi('put article')
  }

  @Delete('/article/:id')
  @Summary('åˆ é™¤æ–‡ç« å†…å®¹')
  @Description('ä»pathParamä¸­æ•ˆéªŒå‚æ•°')
  @Responses({ status: 200, definition: 'ValidateTest' })
  @Parameters(PathId)
  public async deleteArticle(ctx) {
    return await ctx.service.test.sayHi('delete article')
  }
}


      </code></pre><p>å¯å¸¦åŠ²æ¥ï¼æ¥ä¸‹æ¥è¿›å…¥æ­£æ–‡~</p><h1 id="usage"><a href="#/?id=usage" data-id="usage" class="anchor"><span>Usage</span></a></h1><pre v-pre="" data-lang="typescript"><code class="lang-typescript">

import { Application } from 'egg'

const { EggShell } = require('@/dependency/egg-shell')

/**
 *  swaggeræ–‡æ¡£åœ°å€: http://host:port/swagger-ui/index.html
 *
 *  æ³¨: URLé¦–å­—æ¯å…¨éƒ¨ä¼šè¢«è½¬æˆå°å†™ã€‚
 *  æ¯”å¦‚ /Demo/JsonWebToken, ä¼šå˜æˆ/demo/jsonWebToken
 */
export default (app: Application) => {

  EggShell(app, {
    prefix: '/', // è®¾ç½®å…¨å±€å‰ç¼€
    autoResponse: true, // æ§åˆ¶å™¨æ–¹æ³•returnç»“æœå,è‡ªåŠ¨è¿”å›JSONæ ¼å¼æ•°æ®
      defaultIndex: '/home',  // è®¾ç½®é»˜è®¤é¦–é¡µ, ä¹‹æ‰€ä»¥ä¸è®¾ç½®index.tsä½œä¸ºå…¥å£ç›®å½•, æ˜¯æ€•indexæ§åˆ¶å™¨ä¸‹é¢çš„actionä¼šæ±¡æŸ“å…¨å±€åœ°å€
      jwtValidationName: 'routerMiddleware.jwtValidate',  // é…ç½®jwtæ•ˆéªŒçš„ä¸­é—´ä»¶å, å¯ä»¥è®¾ç½®@ignoreJwtæˆ–@ignoreJwtAllæ¥è·³è¿‡è¯¥æ•ˆéªŒ
      openValidate: true,  // æ˜¯å¦å¼€å¯è¯·æ±‚å‚æ•°æ•ˆéªŒ
      swaggerOpt: {
          open: true,
          title: 'Nodeç½‘å…³æ¥å£æ–‡æ¡£',
          version: '1.0.0',
          // ç›´æ¥é‡å†™äº†egg-shellçš„definitionåˆ›å»ºæ–¹æ³•, æ ¼å¼è·Ÿegg-swagger-docä¸€æ ·, æ–¹ä¾¿è€é¡¹ç›®å¤åˆ¶ã€‚
          // æ³¨æ„, definitionçš„è·¯å¾„è·Ÿcontrollerçš„è·¯å¾„åšäº†å¼ºç»‘å®š, ä¸ºäº†ç¡®ä¿åå­—ä¸ä¼šå†²çªã€‚
          definitionPath: './app/definition',
      }
  })
}


      </code></pre><p>å¦‚æœä¸æ˜¯é‡‡ç”¨ TypeScript è„šæ‰‹æ¶ï¼Œåˆ™éœ€åœ¨å…¥å£æ³¨å†Œ Bable æ’ä»¶ä½¿å…¶æ”¯æŒ Decoratorï¼š</p><pre v-pre="" data-lang="javascript"><code class="lang-javascript"><span class="token comment">// app.js</span>
<span class="token string">'use strict'</span><span class="token punctuation">;</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'babel-register'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token string">'transform-decorators-legacy'</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h1 id="option"><a href="#/?id=option" data-id="option" class="anchor"><span>Option</span></a></h1><pre v-pre="" data-lang="json"><code class="lang-json">
import { EggAppConfig, EggAppInfo, PowerPartial } from 'egg';

export default (appInfo: EggAppInfo) => {
  const config = {} as PowerPartial<EggAppConfig>;

  // eggå…¨å±€ä¸­é—´ä»¶, æ³¨: æ‰€æœ‰ä¸­é—´ä»¶é¦–å­—æ¯éƒ½æ˜¯å°å†™å“¦
  config.middleware = ['handleError'];

  // è‡ªå®šä¹‰ä¸­é—´ä»¶å±‚çº§ä»å¤–åˆ°é‡Œçš„é¡ºåºä¾æ¬¡æ˜¯:
  // router before -> controller before -> action before -> action after -> controller after -> router after
  // æµ‹è¯•è·¯å¾„: /demo/weglogic

  // egg-shellå¯¹è·¯ç”±ä¸­é—´ä»¶åšäº†æ§åˆ¶, è¿™é‡Œæ˜¯æ‰§è¡Œåœ¨æ§åˆ¶å™¨ä¹‹å‰
  config.routerBeforeMiddleware = ['routerMiddleware.jwtValidate'];
  // egg-shellå¯¹è·¯ç”±ä¸­é—´ä»¶åšäº†æ§åˆ¶, è¿™é‡Œæ˜¯æ‰§è¡Œåœ¨æ§åˆ¶å™¨ä¹‹å
  config.routerAfterMiddleware = ['routerMiddleware.renderJson'];

  // ä¸­é—´ä»¶é…ç½®æ–¹å¼
  // ä¸­é—´ä»¶å¤šçº§ç›®å½•, éœ€è¦åŠ ä¸€çº§æ–‡ä»¶å¤¹åå­—, æ³¨å†Œçš„æ—¶å€™ä¹Ÿéœ€è¦å¸¦ä¸Š,
  // æ¯”å¦‚ @Before('RouterMiddleware.TestActAfter')
  // æˆ–è€… config.routerAfterMiddleware = ['routerMiddleware.testActAfter'];
  config.routerMiddleware = {
      jwtValidate: { responseErrorStatus: 403 },
      testCtrlBefore: { test: 'ctrlBefore' },
      testCtrlAfter: { test: 'ctrlAfter' },
      testActBefore: { test: 'actBefore' },
      testActAfter: { test: 'actAfter' }
  };

  // eggShell config
  config.eggShellDefaultConf = {
      defaultIndex: '/home',  // è®¾ç½®é»˜è®¤é¦–é¡µ, ä¹‹æ‰€ä»¥ä¸è®¾ç½®index.tsä½œä¸ºå…¥å£ç›®å½•, æ˜¯æ€•indexæ§åˆ¶å™¨ä¸‹é¢çš„actionä¼šæ±¡æŸ“å…¨å±€åœ°å€
      jwtValidationName: 'routerMiddleware.jwtValidate',  // é…ç½®jwtæ•ˆéªŒçš„ä¸­é—´ä»¶å, å¯ä»¥è®¾ç½®@ignoreJwtæˆ–@ignoreJwtAllæ¥è·³è¿‡è¯¥æ•ˆéªŒ
      openValidate: true,  // æ˜¯å¦å¼€å¯è¯·æ±‚å‚æ•°æ•ˆéªŒ
      swaggerOpt: {
          open: true,
          title: 'Nodeç½‘å…³æ¥å£æ–‡æ¡£',
          version: '1.0.0',
          // ç›´æ¥é‡å†™äº†egg-shellçš„definitionåˆ›å»ºæ–¹æ³•, æ ¼å¼è·Ÿegg-swagger-docä¸€æ ·, æ–¹ä¾¿è€é¡¹ç›®å¤åˆ¶ã€‚
          // æ³¨æ„, definitionçš„è·¯å¾„è·Ÿcontrollerçš„è·¯å¾„åšäº†å¼ºç»‘å®š, ä¸ºäº†ç¡®ä¿åå­—ä¸ä¼šå†²çªã€‚
          definitionPath: './app/definition',
          tokenOpt: {
              tokens: {
                  manager: '123',
              },
          }
      },
  };

  return {
    ...config,
  };
};

          </code></pre><h1 id="member"><a href="#/?id=member" data-id="member" class="anchor"><span>Member</span></a></h1><p><code>Method</code>ä»£è¡¨è£…é¥°çš„æ˜¯ Controller é‡Œçš„å‡½æ•°ï¼Œè€Œ<code>Controller</code>åˆ™æ˜¯è£…é¥°æ§åˆ¶å™¨çš„ã€‚</p>

      <h2 id="httpç›¸å…³"><a href="#/?id=http%e7%9b%b8%e5%85%b3" data-id="httpç›¸å…³" class="anchor"><span>Httpç›¸å…³</span></a></h2><ul><li>Method<ul><li>âœ… <code>Get</code> (string)<ul><li>è·¯ç”±è·¯å¾„</li></ul></li><li>âœ… <code>Post</code> (string)<ul><li>è·¯ç”±è·¯å¾„</li></ul></li><li>âœ… <code>Put</code> (string)<ul><li>è·¯ç”±è·¯å¾„</li></ul></li><li>âœ… <code>Delete</code> (string)<ul><li>è·¯ç”±è·¯å¾„</li></ul></li><li>âœ… <code>Patch</code> (string)<ul><li>è·¯ç”±è·¯å¾„</li></ul></li><li>âœ… <code>Options</code> (string)<ul><li>è·¯ç”±è·¯å¾„</li></ul></li><li>âœ… <code>Head</code> (string)<ul><li>è·¯ç”±è·¯å¾„</li></ul></li><li>ğŸ”² Header</li></ul></li></ul>

      <pre v-pre="" data-lang="typescript"><code class="lang-typescript">
import { Controller } from 'egg'

const {
  Get,
  Post,
  Put,
  Delete,
  TagsAll,
  IgnoreJwtAll
} = require('@/dependency/egg-shell')

@TagsAll('ç®€å•çš„Restfulç¤ºä¾‹')
@IgnoreJwtAll
export default class RestfulController extends Controller {
  @Get('/test')
  public async testGet(ctx) {
    return await ctx.service.test.sayHi('restful get')
  }
  @Post('/test')
  public async testPost(ctx) {
    return await ctx.service.test.sayHi('restful post')
  }
  @Put('/test')
  public async testPut(ctx) {
    return await ctx.service.test.sayHi('restful put')
  }
  @Delete('/test')
  public async testDelete(ctx) {
    return await ctx.service.test.sayHi('restful delete')
  }
}

      </code></pre>

      <h2 id="ä¸­é—´ä»¶ç›¸å…³"><a href="#/?id=%e4%b8%ad%e9%97%b4%e4%bb%b6%e7%9b%b8%e5%85%b3" data-id="ä¸­é—´ä»¶ç›¸å…³" class="anchor"><span>ä¸­é—´ä»¶ç›¸å…³</span></a></h2><ul><li>Method<ul><li>âœ… <code>Before</code> (Function[])<ul><li>ä¸­é—´ä»¶</li></ul></li><li>âœ… <code>After</code>  (Function[])<ul><li>ä¸­é—´ä»¶</li></ul></li></ul></li><li>Controller<ul><li>âœ… <code>BeforeAll</code> (Function[])<ul><li>ä¸­é—´ä»¶</li></ul></li><li>âœ… <code>AfterAll</code> (Function[])<ul><li>ä¸­é—´ä»¶</li></ul></li></ul></li></ul>

      <pre v-pre="" data-lang="typescript"><code class="lang-typescript">
import { Controller } from 'egg'

const {
  Get,
  TagsAll,
  IgnoreJwtAll,
  BeforeAll,
  AfterAll,
  Before,
  After
} = require('@/dependency/egg-shell')

/**
 * è·¯ç”±ä¸­é—´ä»¶å±‚çº§ä»å¤–åˆ°é‡Œçš„é¡ºåºä¾æ¬¡æ˜¯:
 * router before -> controller before -> action before -> action after -> controller after -> router after
 */
@TagsAll('è·¯ç”±ä¸­é—´ä»¶ç¤ºä¾‹')
@IgnoreJwtAll // æ•´ä¸ªæ§åˆ¶å™¨å¿½ç•¥JWTæ•ˆéªŒ
@BeforeAll('routerMiddleware.testCtrlBefore') // ç»‘å®šä¸­é—´ä»¶, å¤šä¸ªä¸­é—´ä»¶å¯ä»¥ä¼ æ•°ç»„
@AfterAll('routerMiddleware.testCtrlAfter') // ç»‘å®šä¸­é—´ä»¶, å¤šä¸ªä¸­é—´ä»¶å¯ä»¥ä¼ æ•°ç»„
export default class WeblogicController extends Controller {
  @Get()
  @Before('routerMiddleware.testActBefore') // ç»‘å®šä¸­é—´ä»¶, å¤šä¸ªä¸­é—´ä»¶å¯ä»¥ä¼ æ•°ç»„
  @After('routerMiddleware.testActAfter') // ç»‘å®šä¸­é—´ä»¶, å¤šä¸ªä¸­é—´ä»¶å¯ä»¥ä¼ æ•°ç»„
  public async index(ctx) {
    console.log('send request ......')
    // æ³¨æ„, å¦‚æœåœ¨æ§åˆ¶å™¨é‡Œåšäº†returnä¹‹å, ä¼šè‡ªåŠ¨è°ƒç”¨ä¸€æ¬¡nextæ–¹æ³•, ç»§ç»­æ‰§è¡Œåé¢çš„ä¸­é—´ä»¶ã€‚
    // å½“ç„¶ä¹Ÿå¯ä»¥ä¸åšreturn, è‡ªå·±è°ƒç”¨nextæ–¹æ³•, æˆ–è€…ä¸è°ƒç”¨ã€‚
    return await ctx.service.test.sayHi('weblogic')
  }
}

          </code></pre>

      <h2 id="swagger-uiç›¸å…³"><a href="#/?id=swagger-ui%e7%9b%b8%e5%85%b3" data-id="swagger-uiç›¸å…³" class="anchor"><span>Swagger Uiç›¸å…³</span></a></h2><ul><li>Method<ul><li>âœ… <code>Summary</code> (<code>summary</code>: string)<ul><li>å¯¹åº” swagger-ui è·¯ç”±çš„ summary</li></ul></li><li>âœ… <code>Description</code> (<code>description</code>: string)<ul><li>å¯¹åº” swagger-ui è·¯ç”±çš„ description</li></ul></li><li>âœ… <code>Parameters</code> (<code>parameters</code>: object[])<ul><li>å¯¹åº” swagger-ui è·¯ç”±çš„ parameters, åŸºäºJoiçš„æ ¼å¼, æ–¹ä¾¿å‚æ•°æ•ˆéªŒ</li></ul></li><li>âœ… <code>Responses</code> (<code>responses</code>: object)<ul><li>å¯¹åº” swagger-ui è·¯ç”±çš„ responsesæ ¼å¼, åé¢æœ‰ä»‹ç»</li></ul></li><li>âœ… <code>Produces</code> (<code>produces</code>: string[] || string)<ul><li>å¯¹åº” swagger-ui è·¯ç”±çš„ producesï¼Œå½“ä¼ å…¥stringç±»å‹æ—¶ä¼šè‡ªåŠ¨å¤„ç†ä¸º [ string ]</li></ul></li><li>âœ… <code>Consumes</code> (<code>consumes</code>: string[] || string)<ul><li>å¯¹åº” swagger-ui è·¯ç”±çš„ consumesï¼Œå½“ä¼ å…¥stringç±»å‹æ—¶ä¼šè‡ªåŠ¨å¤„ç†ä¸º [ string ]</li></ul></li><li>âœ… <code>Hidden</code><ul><li>éšè—è¯¥æ¥å£çš„æ–‡æ¡£</li></ul></li><li>âœ… <code>TokenType</code> (<code>type</code>: string)<ul><li>é…ç½®è¯¥æ¥å£çš„ token ç±»å‹ï¼ˆå…·ä½“æŸ¥çœ‹<code>Example &gt; Swagger Ui &gt; Toekn</code>ï¼‰</li></ul></li></ul></li><li>Controller<ul><li>âœ… <code>TagsAll</code> (<code>descriptions</code>: string, <code>name</code>: string)<ul><li>å¯¹åº” swagger-ui è·¯ç”±çš„ tagsï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸º tag æè¿°ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸º tag çš„åç§°ï¼Œç¬¬äºŒä¸ªå‚æ•°å¦‚æœä¸å¡«ä¼šè‡ªåŠ¨æŠŠå½“å‰æ–‡ä»¶çš„ <code>prefix</code> ä½œä¸ºæ­¤å‚æ•°ï¼ˆå»ºè®®ä¸å¡«å†™ï¼‰ã€‚</li></ul></li><li>âœ… <code>HiddenAll</code><ul><li>éšè—è¯¥æ§åˆ¶å™¨æ‰€æœ‰è·¯ç”±çš„æ¥å£æ–‡æ¡£</li></ul></li><li>âœ… <code>TokenTypeAll</code> (<code>type</code>: string)<ul><li>é…ç½®è¯¥æ§åˆ¶å™¨æ‰€æœ‰è·¯ç”±çš„ token ç±»å‹ï¼ˆå…·ä½“æŸ¥çœ‹<code>Example &gt; Swagger Ui &gt; Token</code>ï¼‰</li></ul></li></ul></li></ul>

      <pre v-pre="" data-lang="typescript"><code class="lang-typescript">
// æ–‡ä»¶è·¯å¾„ /app/controller/demo/validate.ts

import { Controller } from 'egg'
const { Joi } = require('@/dependency/egg-shell')

const {
  Get,
  Post,
  Put,
  Delete,
  TagsAll,
  IgnoreJwtAll,
  Parameters,
  Summary,
  Description,
  Responses
} = require('@/dependency/egg-shell')

const joiScheme = Joi.object()

const PathId = {
  pathParams: Joi.object()
    .keys({
      id: Joi.number()
        .integer()
        .required()
        .description('æ–‡ç« ID')
    })
    .description('pathå‚æ•°')
}

const PostCreate = Joi.object()
  .json()
  .keys({
    title: Joi.string()
      .required()
      .description('æ ‡é¢˜'),
    author: Joi.string()
      .required()
      .description('ä½œè€…'),
    summary: Joi.string()
      .required()
      .description('æ‘˜è¦'),
    pub_date: Joi.date(),
    content: Joi.string()
      .required()
      .description('å†…å®¹(html)')
  })
  .description('æ–‡ç« å†…å®¹æ ¼å¼')

const GetArticleValidate = {
  query: joiScheme.keys({
    page: Joi.number()
      .integer()
      .optional()
      .default(1)
      .description('å½“å‰é¡µæ•°'),
    limit: Joi.number()
      .integer()
      .optional()
      .default(10)
      .description('æ¯é¡µæ¡æ•°')
  })
}

const PostArticleValidate = {
  body: Joi.object().keys({
    entity: PostCreate.required()
  })
}

const PutArticleValidate = {
  pathParams: PathId.pathParams,
  ...PostArticleValidate
}

/**
 * å¯ä»¥åœ¨æ•ˆéªŒè¯·æ±‚å‚æ•°çš„åŒæ—¶,
 * è‡ªåŠ¨ç”Ÿæˆswaggerå‚æ•°æ–‡æ¡£ã€‚
 */
@TagsAll('å‚æ•°æ•ˆéªŒç¤ºä¾‹')
@IgnoreJwtAll
export default class ValidateController extends Controller {
  /**
   * æ³¨æ„! æ³¨æ„!
   * ä¸€ã€@Parametersæ³¨è§£å·²ç»è¢«é‡å†™äº†, å¯ä»¥åœ¨æ•ˆéªŒå‚æ•°çš„åŒæ—¶, å¹¶ç”Ÿæˆswaggerå‚æ•°æ–‡æ¡£ã€‚
   * äºŒã€@Responsesæ³¨è§£ä¹Ÿè¢«é‡å†™äº†, å›ºå®šæ ¼å¼ä¸º:
   * @Responses({ statsu: 200, definition: 'User', description: 'fuck you'})
   * ä¼ å¤šä¸ªè¿”å›çŠ¶æ€, éœ€è¦ä¼ å…¥ä¸€ä¸ªæ•°ç»„ã€‚
   */
  @Get('/articles')
  @Summary('è·å–æ–‡ç« åˆ—è¡¨')
  @Description('ä»queryä¸­æ•ˆéªŒå‚æ•°')
  @Parameters(GetArticleValidate)
  @Responses({ status: 200, definition: 'ValidateTest' })
  public async getArticleList(ctx) {
    return await ctx.service.test.sayHi('get artice list')
  }

  @Get('/article/:id')
  @Summary('è·å–æ–‡ç« åˆ—è¡¨')
  @Description('ä»pathParamä¸­æ•ˆéªŒå‚æ•°')
  @Parameters(PathId)
  @Responses({ status: 200, definition: 'ValidateTest' })
  public async getArticle(ctx) {
    return await ctx.service.test.sayHi('get artice')
  }

  @Post('/article/:id')
  @Summary('åˆ›å»ºæ–‡ç« å†…å®¹')
  @Description('ä»bodyä¸­æ•ˆéªŒå‚æ•°')
  @Parameters(PostArticleValidate)
  @Responses({ status: 200, definition: 'ValidateTest' })
  public async createArticle(ctx) {
    return await ctx.service.test.sayHi('post article')
  }

  @Put('/article/:id')
  @Summary('ä¿®æ”¹æ–‡ç« å†…å®¹')
  @Description('ä»bodyå’ŒpathParamä¸­æ•ˆéªŒå‚æ•°')
  @Parameters(PutArticleValidate)
  @Responses({ status: 200, definition: 'ValidateTest' })
  public async updateArticle(ctx) {
    return await ctx.service.test.sayHi('put article')
  }

  @Delete('/article/:id')
  @Summary('åˆ é™¤æ–‡ç« å†…å®¹')
  @Description('ä»pathParamä¸­æ•ˆéªŒå‚æ•°')
  @Responses({ status: 200, definition: 'ValidateTest' })
  @Parameters(PathId)
  public async deleteArticle(ctx) {
    return await ctx.service.test.sayHi('delete article')
  }
}

      </code></pre>

      <pre v-pre="" data-lang="typescript"><code class="lang-typescript">
// æ–‡ä»¶è·¯å¾„ app/definition/demo/validate.ts

module.exports = {
  ValidateTest: {
    teacher_id: { type: 'integer', require: true, description: 'æ•™å¸ˆID' },
    subject_id: { type: 'integer', require: true, description: 'ç§‘ç›®ID' },
    teacher_name: { type: 'string', description: 'æ•™å¸ˆå§“å' },
    subject_name: { type: 'string', description: 'ç§‘ç›®åç§°ï¼Œå¯èƒ½ä¸ºNull' }
  }
}

      </code></pre>

      <h2 id="jwtç›¸å…³"><a href="#/?id=jwt%e7%9b%b8%e5%85%b3" data-id="jwtç›¸å…³" class="anchor"><span>Jwtç›¸å…³</span></a></h2><ul><li>Method<ul><li>âœ… <code>IgnoreJwt</code><ul><li>å¿½ç•¥è¯¥è·¯ç”±çš„ jwt æ ¡éªŒ</li></ul></li></ul></li><li>Controller<ul><li>âœ… <code>IgnoreJwtAll</code><ul><li>å¿½ç•¥è¯¥æ§åˆ¶å™¨æ‰€æœ‰è·¯ç”±çš„ jwt æ ¡éªŒ</li></ul></li></ul></li></ul><h2 id="å…¶ä»–"><a href="#/?id=%e5%85%b6%e4%bb%96" data-id="å…¶ä»–" class="anchor"><span>å…¶ä»–</span></a></h2><ul><li>âœ… <code>EggShell</code>(<code>app</code>: Application, <code>option</code>: object) ï¼ˆéè£…é¥°å™¨ï¼‰<ul><li>æ ¸å¿ƒå¯¹è±¡</li></ul></li><li>âœ… <code>StatusError</code>(<code>message</code>: string, <code>status</code>?: number) ï¼ˆéè£…é¥°å™¨ï¼‰<ul><li>ï¼ˆéè£…é¥°å™¨ï¼‰message ä¸ºé”™è¯¯ä¿¡æ¯ï¼Œstatus ä¸ºçŠ¶æ€ç ï¼ˆé»˜è®¤å€¼ä¸º500ï¼‰</li></ul></li><li>Method<ul><li>âœ… <code>Message</code>(<code>message</code>: string)<ul><li>QuickStart æ¨¡å¼è¿”å›çš„ä¿¡æ¯</li></ul></li></ul></li><li>Controller<ul><li>âœ… <code>Prefix</code><ul><li>è·¯ç”±çš„å‰ç¼€ï¼Œç”¨äºå–ç¼”<code>è·¯ç”±è§£æ</code>ç»™çš„å‰ç¼€ï¼ˆprefixï¼‰</li></ul></li></ul></li></ul>
</article></section></main>

<script>
  window.$docsify = {
    name: 'egg-shell-decorators è›‹å£³',
    auto2top: true,
    loadNavbar: true,
    repo: 'super2god/egg-shell-decorators'
  }
</script>
<script src="js/docsify.min.js"></script>
<script src="js/prism-json.min.js"></script>
<script src="js/prism-typescript.min.js"></script>
<script src="js/zoom-image.min.js"></script>
<div class="progress" style="opacity: 0; width: 0%;"></div></body></html>